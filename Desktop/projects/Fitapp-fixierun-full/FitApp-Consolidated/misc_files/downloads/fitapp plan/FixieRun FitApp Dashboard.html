<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FixieRun FitApp Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css">
    <style>
        :root {
            --primary-color: #5D5CDE;
            --secondary-color: #4A4AB7;
            --light-bg: #FFFFFF;
            --dark-bg: #181818;
            --light-text: #212529;
            --dark-text: #E9ECEF;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: var(--light-text);
            padding-top: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .dark body {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            border: none;
            background-color: var(--light-bg);
            color: var(--light-text);
            transition: background-color 0.3s, color 0.3s;
        }
        
        .dark .card {
            background-color: #242424;
            color: var(--dark-text);
        }
        
        .card-header {
            background-color: rgba(0, 0, 0, 0.03);
            border-bottom: 1px solid rgba(0, 0, 0, 0.125);
            font-weight: bold;
        }
        
        .dark .card-header {
            background-color: #333;
            border-bottom: 1px solid #444;
        }
        
        .stats-card {
            text-align: center;
            transition: transform 0.3s, background-color 0.3s;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .stats-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .stats-value {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .stats-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .dark .stats-label {
            color: #adb5bd;
        }
        
        #mapContainer {
            height: 400px;
            border-radius: 10px;
        }
        
        .highlight {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        .dark .highlight {
            background-color: rgba(93, 92, 222, 0.2);
        }
        
        .table {
            color: var(--light-text);
        }
        
        .dark .table {
            color: var(--dark-text);
        }
        
        .table th {
            position: sticky;
            top: 0;
            background-color: var(--light-bg);
            z-index: 1;
        }
        
        .dark .table th {
            background-color: #242424;
        }
        
        .activity-table-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 0 0 10px 10px;
        }
        
        .dark .table-hover tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.075);
        }
        
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }
        
        .loading-text {
            margin-left: 10px;
        }
        
        #yearRangeSelector {
            margin-bottom: 15px;
        }
        
        .no-data-message {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #6c757d;
        }
        
        footer {
            color: #6c757d;
        }
        
        .dark footer {
            color: #adb5bd;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1>FixieRun FitApp Dashboard</h1>
                    <p class="lead mb-0">Fitness activity insights and analytics from your location history</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <p id="lastUpdated" class="mb-0">Loading data...</p>
                </div>
            </div>
        </div>

        <!-- Year Range Selector -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div id="yearRangeSelector" class="d-flex justify-content-between align-items-center">
                            <label for="yearRange" class="form-label mb-0 me-3">Filter by Year:</label>
                            <select id="yearRange" class="form-select" style="max-width: 150px;">
                                <option value="all">All Years</option>
                                <!-- Year options will be added by JavaScript -->
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Stats -->
        <div class="row">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="stats-icon">üìä</div>
                        <div id="totalActivities" class="stats-value">...</div>
                        <div class="stats-label">Total Activities</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="stats-icon">üö≤</div>
                        <div id="totalDistance" class="stats-value">...</div>
                        <div class="stats-label">Total Kilometers</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="stats-icon">‚è±Ô∏è</div>
                        <div id="totalHours" class="stats-value">...</div>
                        <div class="stats-label">Total Hours</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="stats-icon">üî•</div>
                        <div id="avgDistance" class="stats-value">...</div>
                        <div class="stats-label">Avg Distance (km)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Distribution and Monthly Activity -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Activity Distribution by Type</div>
                    <div class="card-body">
                        <canvas id="activityTypeChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Monthly Activity Distribution</div>
                    <div class="card-body">
                        <canvas id="monthlyActivityChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Distance and Duration -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Distance by Year</div>
                    <div class="card-body">
                        <canvas id="distanceChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Average Distance by Month</div>
                    <div class="card-body">
                        <canvas id="avgDistanceByMonthChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activities Table and Map -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Recent Activities (<span id="activityCount">Loading...</span>)</div>
                    <div class="card-body p-0 activity-table-container">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Activity</th>
                                    <th>Distance (km)</th>
                                    <th>Duration (min)</th>
                                </tr>
                            </thead>
                            <tbody id="activitiesTable">
                                <!-- Table rows will be populated by JavaScript -->
                                <tr>
                                    <td colspan="5">
                                        <div class="loading-spinner">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <span class="loading-text">Loading activity data...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Activity Map</div>
                    <div class="card-body p-0">
                        <div id="mapContainer"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Yearly Progress Section -->
        <div class="row mt-4">
            <div class="col">
                <div class="card">
                    <div class="card-header">Yearly Activity Counts</div>
                    <div class="card-body">
                        <canvas id="yearlyProgressChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-4 mb-4 text-center">
            <p>¬© 2025 FixieRun FitApp Tracker | All data sourced from location history (2017-2025)</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script>
        // Check for dark mode preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Load and process the fitness data
        let allActivities = [];
        let filteredActivities = [];
        let map = null;
        let markers = [];
        let chartInstances = {};

        // Simulated data load from the JSON file
        // In a real application, this would be an actual fetch of the data
        async function loadFitnessData() {
            try {
                // Simulate fetching the data
                // This is where we'd normally load from the JSON file
                const activities = generateSampleData();
                
                // Process the data
                allActivities = activities;
                filteredActivities = [...allActivities];
                
                // Update the UI with the loaded data
                populateYearSelector();
                updateDashboard();
                
                // Set the current date in the last updated field
                const now = new Date();
                document.getElementById('lastUpdated').textContent = `Last updated: ${now.toLocaleString()}`;
            } catch (error) {
                console.error('Error loading fitness data:', error);
                document.getElementById('lastUpdated').textContent = 'Error loading data';
            }
        }

        // Update all dashboard components based on the filtered activities
        function updateDashboard() {
            updateSummaryStats();
            populateActivitiesTable();
            updateAllCharts();
            updateMap();
        }

        // Update the summary statistics
        function updateSummaryStats() {
            // Total activities
            document.getElementById('totalActivities').textContent = filteredActivities.length.toLocaleString();
            
            // Total distance
            const totalDistance = filteredActivities.reduce((sum, a) => sum + a.distance_km, 0);
            document.getElementById('totalDistance').textContent = totalDistance.toFixed(1);
            
            // Total hours
            const totalMinutes = filteredActivities.reduce((sum, a) => {
                const start = new Date(a.start_time.replace(' ', 'T'));
                const end = new Date(a.end_time.replace(' ', 'T'));
                return sum + (end - start) / (1000 * 60);
            }, 0);
            document.getElementById('totalHours').textContent = (totalMinutes / 60).toFixed(1);
            
            // Average distance
            const avgDistance = totalDistance / filteredActivities.length || 0;
            document.getElementById('avgDistance').textContent = avgDistance.toFixed(1);
            
            // Highlight 2025 data if present
            const hasData2025 = filteredActivities.some(activity => activity.start_time.startsWith('2025'));
            if (hasData2025 && (filteredActivities === allActivities || document.getElementById('yearRange').value === '2025')) {
                document.querySelectorAll('.stats-card').forEach(card => {
                    card.classList.add('highlight');
                });
            } else {
                document.querySelectorAll('.stats-card').forEach(card => {
                    card.classList.remove('highlight');
                });
            }
        }

        // Populate activities table with the filtered data
        function populateActivitiesTable() {
            const tableBody = document.getElementById('activitiesTable');
            tableBody.innerHTML = '';
            
            // Update the activity count in the header
            document.getElementById('activityCount').textContent = filteredActivities.length;
            
            if (filteredActivities.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" class="no-data-message">No activities found for the selected filters</td>`;
                tableBody.appendChild(row);
                return;
            }
            
            // Sort by date (newest first) and take the most recent 100
            const sortedActivities = [...filteredActivities]
                .sort((a, b) => new Date(b.start_time) - new Date(a.start_time))
                .slice(0, 100);
            
            sortedActivities.forEach(activity => {
                const row = document.createElement('tr');
                
                // Calculate duration in minutes
                const start = new Date(activity.start_time.replace(' ', 'T'));
                const end = new Date(activity.end_time.replace(' ', 'T'));
                const durationMinutes = (end - start) / (1000 * 60);
                
                // Format date and time
                const dateParts = activity.start_time.split(' ')[0].split('-');
                const formattedDate = `${dateParts[0]}-${dateParts[1]}-${dateParts[2]}`;
                const formattedTime = activity.start_time.split(' ')[1].substring(0, 5);
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${formattedTime}</td>
                    <td>${activity.activity_type}</td>
                    <td>${activity.distance_km.toFixed(2)}</td>
                    <td>${durationMinutes.toFixed(1)}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Initialize or update the map with activity locations
        function updateMap() {
            // If the map doesn't exist yet, create it
            if (!map) {
                map = L.map('mapContainer').setView([50.642, 5.581], 13);
                
                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
            }
            
            // Clear existing markers
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            
            // If no activities, show default view
            if (filteredActivities.length === 0) {
                map.setView([50.642, 5.581], 13);
                return;
            }
            
            // Sample some activities for the map (to avoid too many markers)
            const sampleSize = Math.min(50, filteredActivities.length);
            const step = Math.floor(filteredActivities.length / sampleSize) || 1;
            const sampledActivities = [];
            
            for (let i = 0; i < filteredActivities.length; i += step) {
                sampledActivities.push(filteredActivities[i]);
                if (sampledActivities.length >= sampleSize) break;
            }
            
            // Create bounds for fitting the map
            const bounds = L.latLngBounds();
            
            // Add markers for each sampled activity
            sampledActivities.forEach(activity => {
                if (!activity.start_lat || !activity.start_lon) return;
                
                const marker = L.marker([activity.start_lat, activity.start_lon]).addTo(map);
                
                // Format date for popup
                const date = new Date(activity.start_time.replace(' ', 'T'));
                const formattedDate = date.toLocaleDateString();
                const formattedTime = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                marker.bindPopup(`
                    <strong>${formattedDate} ${formattedTime}</strong><br>
                    Activity: ${activity.activity_type}<br>
                    Distance: ${activity.distance_km.toFixed(2)} km
                `);
                
                bounds.extend([activity.start_lat, activity.start_lon]);
                markers.push(marker);
                
                // If activity has end coordinates, add a line
                if (activity.end_lat && activity.end_lon) {
                    const line = L.polyline(
                        [[activity.start_lat, activity.start_lon], [activity.end_lat, activity.end_lon]],
                        { color: '#5D5CDE', weight: 2, opacity: 0.7 }
                    ).addTo(map);
                    markers.push(line);
                    bounds.extend([activity.end_lat, activity.end_lon]);
                }
            });
            
            // Fit the map to the bounds if we have markers
            if (bounds.isValid()) {
                map.fitBounds(bounds, { padding: [50, 50] });
            }
        }

        // Update or initialize all charts
        function updateAllCharts() {
            updateActivityTypeChart();
            updateMonthlyActivityChart();
            updateDistanceChart();
            updateAvgDistanceByMonthChart();
            updateYearlyProgressChart();
        }

        // Update or initialize Activity Type Chart
        function updateActivityTypeChart() {
            // Count activities by type
            const activityCounts = {};
            filteredActivities.forEach(activity => {
                const type = activity.activity_type;
                activityCounts[type] = (activityCounts[type] || 0) + 1;
            });
            
            const labels = Object.keys(activityCounts).map(type => type.charAt(0).toUpperCase() + type.slice(1));
            const data = Object.values(activityCounts);
            
            // Create or update chart
            const ctx = document.getElementById('activityTypeChart').getContext('2d');
            
            if (chartInstances.activityType) {
                chartInstances.activityType.data.labels = labels;
                chartInstances.activityType.data.datasets[0].data = data;
                chartInstances.activityType.update();
            } else {
                chartInstances.activityType = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                'rgba(93, 92, 222, 0.7)',
                                'rgba(75, 192, 192, 0.7)',
                                'rgba(255, 159, 64, 0.7)',
                                'rgba(54, 162, 235, 0.7)',
                                'rgba(255, 99, 132, 0.7)'
                            ],
                            borderColor: [
                                'rgba(93, 92, 222, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(255, 159, 64, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 99, 132, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // Update or initialize Monthly Activity Chart
        function updateMonthlyActivityChart() {
            // Count activities by month (across all years)
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthlyCounts = Array(12).fill(0);
            
            filteredActivities.forEach(activity => {
                const month = parseInt(activity.start_time.split('-')[1]) - 1; // 0-based month
                monthlyCounts[month]++;
            });
            
            // Create or update chart
            const ctx = document.getElementById('monthlyActivityChart').getContext('2d');
            
            if (chartInstances.monthlyActivity) {
                chartInstances.monthlyActivity.data.datasets[0].data = monthlyCounts;
                chartInstances.monthlyActivity.update();
            } else {
                chartInstances.monthlyActivity = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: monthNames,
                        datasets: [{
                            label: 'Activities',
                            data: monthlyCounts,
                            backgroundColor: 'rgba(93, 92, 222, 0.7)',
                            borderColor: 'rgba(93, 92, 222, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Activities'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
        }

        // Update or initialize Distance Chart
        function updateDistanceChart() {
            // Calculate total distance by year
            const distanceByYear = {};
            
            filteredActivities.forEach(activity => {
                const year = activity.start_time.split('-')[0];
                if (!distanceByYear[year]) distanceByYear[year] = 0;
                distanceByYear[year] += activity.distance_km;
            });
            
            const years = Object.keys(distanceByYear).sort();
            const distances = years.map(year => distanceByYear[year]);
            
            // Create or update chart
            const ctx = document.getElementById('distanceChart').getContext('2d');
            
            if (chartInstances.distance) {
                chartInstances.distance.data.labels = years;
                chartInstances.distance.data.datasets[0].data = distances;
                chartInstances.distance.update();
            } else {
                chartInstances.distance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: years,
                        datasets: [{
                            label: 'Distance (km)',
                            data: distances,
                            backgroundColor: 'rgba(75, 192, 192, 0.7)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Distance (km)'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Update or initialize Average Distance by Month Chart
        function updateAvgDistanceByMonthChart() {
            // Calculate average distance by month
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const distanceByMonth = Array(12).fill(0);
            const countByMonth = Array(12).fill(0);
            
            filteredActivities.forEach(activity => {
                const month = parseInt(activity.start_time.split('-')[1]) - 1; // 0-based month
                distanceByMonth[month] += activity.distance_km;
                countByMonth[month]++;
            });
            
            const avgDistanceByMonth = distanceByMonth.map((total, i) => {
                return countByMonth[i] > 0 ? total / countByMonth[i] : 0;
            });
            
            // Create or update chart
            const ctx = document.getElementById('avgDistanceByMonthChart').getContext('2d');
            
            if (chartInstances.avgDistanceByMonth) {
                chartInstances.avgDistanceByMonth.data.datasets[0].data = avgDistanceByMonth;
                chartInstances.avgDistanceByMonth.update();
            } else {
                chartInstances.avgDistanceByMonth = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: monthNames,
                        datasets: [{
                            label: 'Avg Distance (km)',
                            data: avgDistanceByMonth,
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Avg Distance (km)'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Update or initialize Yearly Progress Chart
        function updateYearlyProgressChart() {
            // Count activities by year
            const yearCounts = {};
            
            filteredActivities.forEach(activity => {
                const year = activity.start_time.split('-')[0];
                yearCounts[year] = (yearCounts[year] || 0) + 1;
            });
            
            const years = Object.keys(yearCounts).sort();
            const counts = years.map(year => yearCounts[year]);
            
            // Create or update chart
            const ctx = document.getElementById('yearlyProgressChart').getContext('2d');
            
            if (chartInstances.yearlyProgress) {
                chartInstances.yearlyProgress.data.labels = years;
                chartInstances.yearlyProgress.data.datasets[0].data = counts;
                chartInstances.yearlyProgress.update();
            } else {
                chartInstances.yearlyProgress = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: years,
                        datasets: [{
                            label: 'Activities',
                            data: counts,
                            backgroundColor: 'rgba(93, 92, 222, 0.7)',
                            borderColor: 'rgba(93, 92, 222, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Activities'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Populate the year selector dropdown
        function populateYearSelector() {
            // Get unique years from activities
            const years = new Set();
            
            allActivities.forEach(activity => {
                const year = activity.start_time.split('-')[0];
                years.add(year);
            });
            
            // Sort years and add to selector
            const sortedYears = [...years].sort();
            const selector = document.getElementById('yearRange');
            
            // Clear existing options (except "All Years")
            while (selector.options.length > 1) {
                selector.remove(1);
            }
            
            // Add year options
            sortedYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                selector.appendChild(option);
            });
            
            // Add event listener for year selection
            selector.addEventListener('change', handleYearSelection);
        }

        // Handle year selection change
        function handleYearSelection() {
            const selectedYear = document.getElementById('yearRange').value;
            
            if (selectedYear === 'all') {
                filteredActivities = [...allActivities];
            } else {
                filteredActivities = allActivities.filter(activity => {
                    return activity.start_time.startsWith(selectedYear);
                });
            }
            
            updateDashboard();
        }

        // Initialize all components when the DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load and process the fitness data
            loadFitnessData();
        });

        // Generate sample data based on the actual JSON data structure
        function generateSampleData() {
            // This function creates a representative sample matching actual data
            // from the location-history_enriched JSON file
            
            const activities = [];
            
            // Sample data from 2017-2025 based on actual data structure
            const years = ['2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024', '2025'];
            const months = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'];
            
            // Primary locations from the dataset - most activities are around Li√®ge, Belgium
            // with some in Barcelona and other locations based on the actual data
            const locationCenters = [
                { lat: 50.642, lon: 5.588, name: "Li√®ge Center" },
                { lat: 50.657, lon: 5.561, name: "Li√®ge North" },
                { lat: 50.636, lon: 5.592, name: "Li√®ge East" },
                { lat: 50.628, lon: 5.576, name: "Li√®ge South" },
                { lat: 41.390, lon: 2.180, name: "Barcelona" }
            ];
            
            // Generate different number of activities for each year to create a natural distribution
            const activityCountByYear = {
                '2017': 350,  // Higher in early years - starting from June
                '2018': 280,
                '2019': 240,
                '2020': 170,
                '2021': 110,
                '2022': 85,
                '2023': 70,
                '2024': 65,
                '2025': 23    // Only a few months of data in 2025
            };
            
            // Actual 2025 activities from the data
            const activities2025 = [
                {
                    start_time: "2025-01-07 02:00:15",
                    end_time: "2025-01-07 02:20:42",
                    activity_type: "cycling",
                    distance_km: 5.29,
                    start_lat: 50.641413,
                    start_lon: 5.581392,
                    end_lat: 50.629352,
                    end_lon: 5.568906,
                    confidence: 1.0
                },
                {
                    start_time: "2025-01-23 09:00:45",
                    end_time: "2025-01-23 09:10:31",
                    activity_type: "cycling",
                    distance_km: 2.52,
                    start_lat: 50.653522,
                    start_lon: 5.562561,
                    end_lat: 50.642598,
                    end_lon: 5.588884,
                    confidence: 1.0
                },
                {
                    start_time: "2025-01-23 17:51:22",
                    end_time: "2025-01-23 18:25:01",
                    activity_type: "cycling",
                    distance_km: 6.09,
                    start_lat: 50.641532,
                    start_lon: 5.581615,
                    end_lat: 50.628426,
                    end_lon: 5.569199,
                    confidence: 1.0
                },
                {
                    start_time: "2025-01-25 18:59:33",
                    end_time: "2025-01-25 19:09:12",
                    activity_type: "cycling",
                    distance_km: 2.16,
                    start_lat: 50.642029,
                    start_lon: 5.581836, 
                    end_lat: 50.629198,
                    end_lon: 5.568223,
                    confidence: 1.0
                },
                {
                    start_time: "2025-01-28 11:15:24",
                    end_time: "2025-01-28 11:24:18",
                    activity_type: "cycling",
                    distance_km: 2.30,
                    start_lat: 50.647161,
                    start_lon: 5.553342,
                    end_lat: 50.645546,
                    end_lon: 5.56103,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-01 21:33:16",
                    end_time: "2025-02-01 21:58:22",
                    activity_type: "cycling",
                    distance_km: 6.53,
                    start_lat: 50.641243,
                    start_lon: 5.580576,
                    end_lat: 50.589487,
                    end_lon: 5.725486,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-03 15:03:19",
                    end_time: "2025-02-03 15:30:04",
                    activity_type: "cycling",
                    distance_km: 6.34,
                    start_lat: 50.642212,
                    start_lon: 5.588128,
                    end_lat: 50.589487,
                    end_lon: 5.725486,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-03 15:36:22",
                    end_time: "2025-02-03 15:41:14",
                    activity_type: "cycling",
                    distance_km: 1.25,
                    start_lat: 50.589487,
                    start_lon: 5.725486,
                    end_lat: 50.584477,
                    end_lon: 5.737795,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-04 18:56:33",
                    end_time: "2025-02-04 19:11:12",
                    activity_type: "cycling",
                    distance_km: 3.36,
                    start_lat: 50.589487,
                    start_lon: 5.725486,
                    end_lat: 50.613639,
                    end_lon: 5.687787,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-05 12:29:14",
                    end_time: "2025-02-05 12:45:24",
                    activity_type: "cycling",
                    distance_km: 2.52,
                    start_lat: 50.613502,
                    start_lon: 5.688416,
                    end_lat: 50.589487,
                    end_lon: 5.725486,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-05 18:42:06",
                    end_time: "2025-02-05 19:00:29",
                    activity_type: "cycling",
                    distance_km: 3.76,
                    start_lat: 50.589487,
                    start_lon: 5.725486,
                    end_lat: 50.620759,
                    end_lon: 5.566489,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-07 00:58:19",
                    end_time: "2025-02-07 01:12:24",
                    activity_type: "cycling",
                    distance_km: 3.65,
                    start_lat: 50.620759,
                    start_lon: 5.566489,
                    end_lat: 50.654595,
                    end_lon: 5.557946,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-08 18:18:54",
                    end_time: "2025-02-08 18:28:37",
                    activity_type: "cycling",
                    distance_km: 2.16,
                    start_lat: 50.646935,
                    start_lon: 5.560077,
                    end_lat: 50.654663,
                    end_lon: 5.557898,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-16 17:28:12",
                    end_time: "2025-02-16 17:40:28",
                    activity_type: "cycling",
                    distance_km: 2.95,
                    start_lat: 50.654663,
                    start_lon: 5.557898,
                    end_lat: 50.645546,
                    end_lon: 5.56103,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-16 18:46:33",
                    end_time: "2025-02-16 19:13:02",
                    activity_type: "cycling",
                    distance_km: 4.86,
                    start_lat: 50.646189,
                    start_lon: 5.578809,
                    end_lat: 50.643604,
                    end_lon: 5.57437,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-16 19:23:15",
                    end_time: "2025-02-16 19:39:28",
                    activity_type: "cycling",
                    distance_km: 3.43,
                    start_lat: 50.643756,
                    start_lon: 5.580182,
                    end_lat: 50.636463,
                    end_lon: 5.59297,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-21 19:55:42",
                    end_time: "2025-02-21 20:13:31",
                    activity_type: "cycling",
                    distance_km: 3.84,
                    start_lat: 50.636463,
                    start_lon: 5.59297,
                    end_lat: 50.648844,
                    end_lon: 5.553873,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-22 14:30:18",
                    end_time: "2025-02-22 14:40:24",
                    activity_type: "cycling",
                    distance_km: 2.23,
                    start_lat: 50.650654,
                    start_lon: 5.565078,
                    end_lat: 50.64085,
                    end_lon: 5.582697,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-22 15:50:07",
                    end_time: "2025-02-22 16:04:32",
                    activity_type: "cycling",
                    distance_km: 3.04,
                    start_lat: 50.641621,
                    start_lon: 5.591702,
                    end_lat: 50.64085,
                    end_lon: 5.582697,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-22 18:03:23",
                    end_time: "2025-02-22 18:20:37",
                    activity_type: "cycling",
                    distance_km: 3.71,
                    start_lat: 50.64085,
                    start_lon: 5.582697,
                    end_lat: 50.648844,
                    end_lon: 5.553873,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-23 13:53:51",
                    end_time: "2025-02-23 14:05:24",
                    activity_type: "cycling",
                    distance_km: 2.43,
                    start_lat: 50.620039,
                    start_lon: 5.566276,
                    end_lat: 50.64085,
                    end_lon: 5.582697,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-23 17:52:42",
                    end_time: "2025-02-23 18:11:46",
                    activity_type: "cycling",
                    distance_km: 3.81,
                    start_lat: 50.64085,
                    start_lon: 5.582697,
                    end_lat: 50.655919,
                    end_lon: 5.570843,
                    confidence: 1.0
                },
                {
                    start_time: "2025-02-26 15:31:16",
                    end_time: "2025-02-26 16:10:24",
                    activity_type: "cycling",
                    distance_km: 3.328059082,
                    start_lat: 50.63777,
                    start_lon: 5.576921,
                    end_lat: 50.628388,
                    end_lon: 5.572509,
                    confidence: 1.0
                }
            ];
            
            // Add the specific 2025 activities
            activities.push(...activities2025);
            
            // Generate the rest of the activities
            for (const year of years) {
                // Skip additional generation for 2025 since we added specific activities
                if (year === '2025') continue;
                
                const activityCount = activityCountByYear[year];
                
                for (let i = 0; i < activityCount; i++) {
                    // Randomly select month with some seasonality (more in summer)
                    const monthWeights = [0.05, 0.06, 0.08, 0.09, 0.1, 0.12, 0.14, 0.12, 0.09, 0.07, 0.05, 0.03];
                    const monthIdx = weightedRandom(monthWeights);
                    const month = months[monthIdx];
                    
                    // For 2017, only generate activities from June onwards
                    if (year === '2017' && monthIdx < 5) continue;
                    
                    // Random day of month (1-28 for simplicity)
                    const day = padZero(Math.floor(Math.random() * 28) + 1);
                    
                    // Random time
                    const hour = padZero(Math.floor(Math.random() * 24));
                    const minute = padZero(Math.floor(Math.random() * 60));
                    const second = padZero(Math.floor(Math.random() * 60));
                    
                    // Create date strings
                    const startDate = `${year}-${month}-${day} ${hour}:${minute}:${second}`;
                    
                    // All activities are cycling based on the data
                    const activityType = "cycling";
                    
                    // Distance - based on the typical range in the data
                    let distance;
                    // Most cycling trips are 1-5 km
                    distance = 1 + Math.random() * 4;
                    // But some are longer
                    if (Math.random() < 0.15) {
                        distance += Math.random() * 10;
                    }
                    distance = parseFloat(distance.toFixed(3));
                    
                    // Duration - based on activity type and distance
                    // Average speed around 12-18 km/h
                    const speedKmh = 12 + Math.random() * 6;
                    const durationMinutes = (distance / speedKmh) * 60;
                    
                    // Calculate end time based on duration
                    const startDateTime = new Date(startDate.replace(' ', 'T'));
                    const endDateTime = new Date(startDateTime.getTime() + durationMinutes * 60 * 1000);
                    const endDate = endDateTime.toISOString().replace('T', ' ').substring(0, 19);
                    
                    // Location - select a center and add some random variation
                    let locationCenter;
                    if (year === '2017' && monthIdx >= 6 && monthIdx <= 8 && Math.random() < 0.5) {
                        // During summer 2017, 50% chance of activities in Barcelona (as seen in the data)
                        locationCenter = locationCenters[4];
                    } else {
                        // Otherwise, activities in Li√®ge area
                        locationCenter = locationCenters[Math.floor(Math.random() * 4)];
                    }
                    
                    const latVariation = (Math.random() - 0.5) * 0.02;
                    const lonVariation = (Math.random() - 0.5) * 0.02;
                    
                    const startLat = locationCenter.lat + latVariation;
                    const startLon = locationCenter.lon + lonVariation;
                    
                    // End location - create a random endpoint based on distance and direction
                    const direction = Math.random() * Math.PI * 2; // Random direction in radians
                    const latOffset = Math.sin(direction) * distance * 0.009; // ~0.009 degrees per km
                    const lonOffset = Math.cos(direction) * distance * 0.014; // ~0.014 degrees per km at this latitude
                    
                    const endLat = startLat + latOffset;
                    const endLon = startLon + lonOffset;
                    
                    // Create the activity object following the exact format from the JSON
                    activities.push({
                        start_time: startDate,
                        end_time: endDate,
                        activity_type: activityType,
                        distance_km: distance,
                        start_lat: parseFloat(startLat.toFixed(6)),
                        start_lon: parseFloat(startLon.toFixed(6)),
                        end_lat: parseFloat(endLat.toFixed(6)),
                        end_lon: parseFloat(endLon.toFixed(6)),
                        confidence: Math.random() < 0.9 ? 1.0 : 0.5 // 90% of activities have high confidence
                    });
                }
            }
            
            // Sort activities by date (oldest first)
            activities.sort((a, b) => new Date(a.start_time) - new Date(b.start_time));
            
            return activities;
        }

        // Helper function for weighted random selection
        function weightedRandom(weights) {
            const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
            const randomValue = Math.random() * totalWeight;
            
            let weightSum = 0;
            for (let i = 0; i < weights.length; i++) {
                weightSum += weights[i];
                if (randomValue <= weightSum) {
                    return i;
                }
            }
            
            return weights.length - 1;
        }

        // Helper function to pad numbers with leading zeros
        function padZero(num) {
            return num.toString().padStart(2, '0');
        }
    </script>


</body></html>